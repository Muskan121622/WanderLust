<% layout('/layouts/boilerplate') %>

<style>
    .card-img-container {
        height: 15rem; /* Sets a fixed height for all image containers */
        overflow: hidden; 
    }

    .card-img-container img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* This is the magic part! */
    }
    
    .glass-container {
        background-color: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px); 
        border: 1px solid rgba(255, 255, 255, 0.3); 
        border-radius: 1rem; 
        padding: 2rem; 
        text-align: center; 
        color: white; 
    }
    
    .glass-container h3 {
        font-weight: 600; 
    }
    
    .glass-container p {
        font-size: 1.1rem;
        opacity: 0.9; 
        margin-bottom: 0;
    }

    .priority-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 0.25rem 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        z-index: 2;
    }

    .priority-high {
        background: #dc3545;
        color: white;
    }

    .priority-medium {
        background: #ffc107;
        color: #212529;
    }

    .priority-low {
        background: #28a745;
        color: white;
    }

    .wishlist-actions {
        position: absolute;
        bottom: 10px;
        right: 10px;
        z-index: 2;
    }

    .wishlist-actions .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        margin-left: 0.25rem;
    }

    .listing-card {
        position: relative;
        transition: transform 0.3s ease;
    }

    .listing-card:hover {
        transform: translateY(-5px);
    }

    .card-notes {
        background: #f8f9fa;
        border-left: 3px solid #667eea;
        padding: 0.5rem;
        margin-top: 0.5rem;
        font-style: italic;
        font-size: 0.9rem;
        color: #6c757d;
    }

    .wishlist-meta {
        font-size: 0.8rem;
        color: #6c757d;
        margin-top: 0.5rem;
    }
</style>

<div class="container my-5">
    <div class="row">
        <div class="col-12 glass-container">
            <h3><i class="fa-solid fa-bookmark me-2"></i>My Wishlist</h3>
            <p>Your saved destinations and dream stays!</p>
        </div>
    </div>
    
    <div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
        <% if (wishlistItems && wishlistItems.length > 0) { %>
            <% for(let item of wishlistItems) { %>
                <% if (item.listing) { %>
                <div class="col">
                    <a href="/listings/<%= item.listing._id %>" class="listing-link">
                        <div class="card listing-card h-100">
                            <!-- Priority Badge -->
                            <div class="priority-badge priority-<%= item.priority %>">
                                <%= item.priority %>
                            </div>
                            
                            <!-- Remove Button -->
                            <div class="wishlist-actions">
                                <form action="/profile/wishlist/<%= item.listing._id %>?_method=DELETE" method="POST" style="display: inline;">
                                    <button type="submit" class="btn btn-outline-danger btn-sm" 
                                            onclick="event.preventDefault(); event.stopPropagation(); if(confirm('Remove from wishlist?')) this.form.submit();">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                            
                            <div class="card-img-container">
                                <img src="<%= item.listing.image && item.listing.image.url ? item.listing.image.url : 'https://via.placeholder.com/300' %>" 
                                     class="card-img-top" alt="<%= item.listing.title || 'Listing Image' %>">
                            </div>
                            
                            <div class="card-body">
                                <p class="card-text">
                                    <b><%= item.listing.title || 'Untitled Listing' %></b><br>
                                    <small class="text-muted">
                                        <i class="fa-solid fa-location-dot me-1"></i><%= item.listing.location || 'Location not available' %>
                                    </small><br>
                                    &#8377;<%= item.listing.price ? item.listing.price.toLocaleString("en-IN") : 'Price not available' %> / night
                                </p>
                                
                                <% if (item.notes) { %>
                                    <div class="card-notes">
                                        "<%= item.notes %>"
                                    </div>
                                <% } %>
                                
                                <div class="wishlist-meta">
                                    Added: <%= new Date(item.addedAt).toLocaleDateString() %>
                                    <% if (item.isPrivate) { %>
                                        <span class="badge bg-secondary ms-1">Private</span>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <% } %>
            <% } %>
        <% } else { %>
            <div class="col-12 glass-container mt-3">
                <p><i class="fa-solid fa-bookmark me-2"></i>You haven't added any listings to your wishlist yet.</p>
                <p>Start exploring to save your favorite destinations!</p>
                <a href="/listings" class="btn btn-primary mt-2">
                    <i class="fa-solid fa-compass me-1"></i>Explore Listings
                </a>
            </div>
        <% } %>
    </div>
</div>